<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>뉴노멀 API 테스트</title>

    <script>
      const API_BASE_URL =
        'https://port-0-newnormal-test2-am952nltb8106p.sel5.cloudtype.app/api/data';

      // 데이터 가져오기
      async function fetchData() {
        try {
          const response = await fetch(API_BASE_URL);
          const data = await response.json();

          const tableBody = document.querySelector('#locationTable tbody');
          tableBody.innerHTML = '';

          data.forEach((item) => {
            const row = document.createElement('tr');

            const idCell = document.createElement('td');
            idCell.textContent = item.id;

            const latitudeCell = document.createElement('td');
            latitudeCell.textContent = item.latitude;

            const longitudeCell = document.createElement('td');
            longitudeCell.textContent = item.longitude;

            row.appendChild(idCell);
            row.appendChild(latitudeCell);
            row.appendChild(longitudeCell);

            tableBody.appendChild(row);
          });
        } catch (error) {
          console.error('Error fetching data:', error);
        }
      }

      // 데이터 추가
      async function addData(event) {
        event.preventDefault();
        const latitude = document.getElementById('latitude').value;
        const longitude = document.getElementById('longitude').value;

        try {
          const response = await fetch(API_BASE_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ latitude, longitude }),
          });

          if (response.ok) {
            alert('데이터가 성공적으로 추가되었습니다!');
            fetchData();
            document.getElementById('latitude').value = '';
            document.getElementById('longitude').value = '';
          } else {
            const errorData = await response.json();
            alert(`Error: ${errorData.error}`);
          }
        } catch (error) {
          console.error('Error adding data:', error);
        }
      }

      //데이터 삭제
      async function deleteData(event) {
        event.preventDefault();
        const id = document.getElementById('deleteId').value;

        try {
          const response = await fetch(`${API_BASE_URL}/${id}`, {
            method: 'DELETE',
          });

          if (response.ok) {
            alert(`ID ${id} 데이터가 성공적으로 삭제되었습니다!`);
            fetchData(); // 데이터 갱신
            document.getElementById('deleteId').value = '';
          } else {
            const errorData = await response.json();
            alert(`Error: ${errorData.error}`);
          }
        } catch (error) {
          console.error('Error deleting data:', error);
        }
      }

      // 페이지 로드 시 초기화
      document.addEventListener('DOMContentLoaded', () => {
        fetchData();
        document
          .getElementById('locationForm')
          .addEventListener('submit', addData);
        document
          .getElementById('deleteForm')
          .addEventListener('submit', deleteData);
      });
    </script>
  </head>

  <body>
    <div class="editData">
      <div class="addData">
        <h1>위치 데이터 추가</h1>
        <form id="locationForm">
          <label for="latitude">Latitude:</label>
          <input type="number" id="latitude" name="latitude" required />
          <label for="longitude">Longitude:</label>
          <input type="number" id="longitude" name="longitude" required />
          <button type="submit">AddData</button>
        </form>
      </div>

      <div class="deleteData">
        <h1>위치 데이터 삭제</h1>
        <form id="deleteForm">
          <label for="deleteId">삭제할 ID:</label>
          <input type="number" id="deleteId" name="deleteId" required />
          <button type="submit">DeleteData</button>
        </form>
      </div>
    </div>

    <div class="readData">
      <h1>위치 데이터</h1>
      <table id="locationTable" border="1">
        <thead>
          <tr>
            <th>ID</th>
            <th>Latitude</th>
            <th>Longitude</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </body>
</html>
